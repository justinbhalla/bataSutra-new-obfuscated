(()=>{"use strict";const e="1WN8151jGQjqbfO0Aj2tK-79yJ9gCD_z0DLCdxs_higg",t=(e,t,n)=>`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv&headers=1&sheet=${encodeURIComponent(t)}&range=${encodeURIComponent(n)}&t=${Date.now()}`;function n(e){if((e||"").trim().startsWith("<"))return{rows:[],isHtml:!0};const t=[];let n=[],o="",r=!1;for(let i=0;i<e.length;i++){const l=e[i];if(r)l!=='"'?o+=l:e[i+1]==='"'?(o+='"',i++):r=!1;else if(l!=='"')if(","===l)n.push(o),o="";else if("\n"===l)n.push(o),t.push(n),n=[],o="";else"\r"!==l&&(o+=l);else r=!0}return(o.length>0||n.length>0)&&(n.push(o),t.push(n)),{rows:t,isHtml:!1}}async function o(o,r){try{const i=await fetch(t(e,o,r),{cache:"no-store"});if(!i.ok)throw new Error("HTTP "+i.status);const l=await i.text(),{rows:a,isHtml:s}=n(l);if(s||!a.length)return[];const c=a[0].map((e=>e.replace(/^\uFEFF/,"").replace(/\u00A0/g," ").trim()));return a.slice(1).filter((e=>e.some((e=>(e??"").toString().trim()!=="")))).map((e=>Object.fromEntries(c.map(((t,n)=>[t,(e[n]??"").toString().trim()])))))}catch{return[]}}function r(e,t,n="right"){const o=document.getElementById(e);if(!o)return;o.classList.remove("ticker-left","ticker-right"),o.textContent="";const r=[...t,...t];r.forEach((e=>{const t=document.createElement("span");t.textContent=String(e||"").trim(),o.appendChild(t)}));const i=(o.parentElement?.clientWidth)||0;for(;o.scrollWidth<2*i;)[...o.children].forEach((e=>o.appendChild(e.cloneNode(!0))));void o.offsetWidth,o.classList.add("right"===n?"ticker-right":"ticker-left","ticker")}async function i(){const e=await o("Headlines","A:B"),t=e.filter((e=>/^top$/i.test(e.Section||""))).map((e=>e.Text)).filter(Boolean),n=e.filter((e=>/^bottom$/i.test(e.Section||""))).map((e=>e.Text)).filter(Boolean);t.length&&r("topTicker",t,"right"),n.length&&r("bottomTicker",n,"left")}const l=e=>document.querySelector(e),a=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("en-IN",{maximumFractionDigits:t}):"—",s=e=>{const t=Number(e);return Number.isFinite(t)?t:NaN},c=(e,t)=>Number.isFinite(e)?e.toFixed(2)+"%":"—";function d({sip:e,i:t,n:n,k:o}){return 0===t?e*n*Math.pow(1+t,o):e*((Math.pow(1+t,n)-1)/t)*Math.pow(1+t,o)}function u({sip0:e,i:t,n:n,k:o,step:r}){const i=(Number(r)||0)/100;let l=0,a=e;for(let e=0;e<n;e++){const r=1===o?n-e:n-e-1;r>=0&&(l+=a*Math.pow(1+t,r)),(e+1)%12==0&&i>0&&(a*=1+i)}return l}function m({sip0:e,n:t,step:n}){const o=(Number(n)||0)/100;let r=0,i=e;for(let e=0;e<t;e++)r+=i,(e+1)%12==0&&o>0&&(i*=1+o);return r}function f({target:e,lumpsumFV:t,i:n,n:o,k:r,step:i,guess:l}){const a=e-t;if(a<=0)return 0;if(!i||0===i){const e=0===n?o*Math.pow(1+n,r):(Math.pow(1+n,o)-1)/n*Math.pow(1+n,r);return a/e}let s=0,c=l>0?4*l:Math.max(1e3,a/o);for(let e=0;e<80;e++){const t=(s+c)/2;u({sip0:t,i:n,n:o,k:r,step:i})>=a?c=t:s=t;if(Math.abs(c-s)<1e-6)break}return(s+c)/2}function p(){const e=l("#mode").value,t=s(l("#freq").value)||12,n=s(l("#years").value),o=(s(l("#rate").value)||0)/100,r=o/t,i=Math.round(t*n),a="start"===l("#timing").value?1:0,c=(s(l("#infl").value)||0)/100,d=s(l("#stepup").value)||0,u=s(l("#lumpsum").value)||0,m=s(l("#target").value),p=s(l("#sip").value),g=s(l("#guess").value)||0,$=Math.max(0,Math.floor(s(l("#startAt").value)||0));return{mode:e,m:t,Y:n,r:o,i:r,n:i,k:a,infl:c,step:d,lump:u,target:m,sip:p,guess:g,startAt:$}}function g({Y:e,m:t,r:n,n:o}){return e>0?t>0?Number.isFinite(n)&&!(n<-1)?o>0&&o<=1e5?"":"Total periods out of range.":"Enter a valid return %.":"Frequency must be > 0.":"Duration must be > 0."}function $(){const e=p(),t=g(e),n=l("#msg");if(n.textContent="",n.className="hint",t)return n.textContent=t,n.className="hint text-red-700",null;const{mode:o,m:r,Y:i,r:c,i:d,n:u,k:h,infl:y,step:v,lump:b,target:E,sip:S,guess:H,startAt:x}=e,w=b*Math.pow(1+d,u);let T={sipShow:NaN,corpusNom:NaN,corpusReal:NaN,invested:NaN,assumptions:`r=${(100*c).toFixed(2)}% • m=${r}/yr • n=${u} • timing=${1===h?"start":"end"}${v?` • step-up ${v}%/yr`:""}${b?` • lump ₹${a(b)}`:""}`};if("goal"===o){if(!(E>0))return n.textContent="Enter a positive target corpus.",n.className="hint text-red-700",null;const e=f({target:E,lumpsumFV:w,i:d,n:u,k:h,step:v,guess:H}),t=v?u({sip0:e,i:d,n:u,k:h,step:v}):dConstantSIP({sip:e,i:d,n:u,k:h});var dConstantSIP=d;const r=w+t,i=(v?m({sip0:e,n:u,step:v}):e*u)+b,l=y>0?r/Math.pow(1+y,i?i/r:1):NaN;T={...T,sipShow:e,corpusNom:r,corpusReal:l,invested:i}}else{const e=Math.max(0,u-(Number.isFinite(x)?x:0)),t=v?(()=>{let t=0,n=S;for(let o=0;o<e;o++){const r=1===h?e-o:e-o-1;r>=0&&(t+=n*Math.pow(1+d,r)),(o+1)%12==0&&v>0&&(n*=(1+v/100))}return t})():d({sip:S,i:d,n:e,k:h}),n=w+t,o=(v?m({sip0:S,n:e,step:v}):S*e)+b,r=y>0?n/Math.pow(1+y,i?i/n:1):NaN;T={...T,sipShow:S,corpusNom:n,corpusReal:r,invested:o}}return n.textContent="Done.",T}function h(e){if(!e)return["outMain","outMainReal","outCorpus","outCorpusReal","outInvested","outAssump"].forEach((e=>y(e,"—"))),void 0;const t=s(l("#infl").value)||0,n=l("#mode").value;y("outMain","goal"===n?`₹ ${a(e.sipShow,0)} / period`:`₹ ${a(e.sipShow,0)} / period (given)`),y("outMainReal",t>0&&"goal"===n?`Real req. SIP ≈ ₹ ${a(e.sipShow/Math.pow(1+t/100,1),0)}*`:"—"),y("outCorpus",Number.isFinite(e.corpusNom)?`₹ ${a(e.corpusNom,0)}`:"—"),y("outCorpusReal",Number.isFinite(e.corpusReal)?`(Real) ₹ ${a(e.corpusReal,0)}`:"—"),y("outInvested",Number.isFinite(e.invested)?`₹ ${a(e.invested,0)}`:"—"),y("outAssump",e.assumptions)}function y(e,t){const n=document.getElementById(e);if(!n)return;const o=String(null!=t?t:"—");n.textContent=o,n.title=o}function v(){const e=l("#mode").value;l("#goalWrap").classList.toggle("hidden","goal"!==e),l("#corpusWrap").classList.toggle("hidden","corpus"!==e),l("#resultLead").textContent="goal"===e?"Required SIP":"Given SIP"}document.getElementById("mode").addEventListener("change",v),document.getElementById("calc").addEventListener("click",(()=>{const e=$();h(e),k()})),document.getElementById("reset").addEventListener("click",(()=>{["#years","#rate","#infl","#stepup","#lumpsum","#target","#guess","#sip","#startAt"].forEach((e=>l(e).value="")) ,l("#freq").value="12",l("#timing").value="end",l("#mode").value="goal",v(),h(null),l("#msg").textContent="",k()})),document.addEventListener("click",(e=>{const t=e.target.closest(".ex");if(!t)return;const n=t.dataset.example;"g1"===n&&(l("#mode").value="goal",v(),l("#freq").value="12",l("#years").value="15",l("#rate").value="12",l("#timing").value="end",l("#target").value="10000000",l("#lumpsum").value="0",l("#stepup").value="0",l("#infl").value="5"),"g2"===n&&(l("#mode").value="goal",v(),l("#freq").value="12",l("#years").value="20",l("#rate").value="12",l("#timing").value="start",l("#target").value="20000000",l("#stepup").value="10",l("#lumpsum").value="0",l("#infl").value="5"),"g3"===n&&(l("#mode").value="goal",v(),l("#freq").value="12",l("#years").value="10",l("#rate").value="11",l("#timing").value="end",l("#target").value="5000000",l("#stepup").value="0",l("#lumpsum").value="0",l("#infl").value="0"),"c1"===n&&(l("#mode").value="corpus",v(),l("#freq").value="12",l("#years").value="12",l("#rate").value="11",l("#timing").value="end",l("#sip").value="25000",l("#lumpsum").value="200000",l("#startAt").value="0",l("#stepup").value="0",l("#infl").value="0"),"c2"===n&&(l("#mode").value="corpus",v(),l("#freq").value="12",l("#years").value="20",l("#rate").value="12",l("#timing").value="start",l("#sip").value="15000",l("#lumpsum").value="0",l("#startAt").value="0",l("#stepup").value="10",l("#infl").value="0"),"c3"===n&&(l("#mode").value="corpus",v(),l("#freq").value="12",l("#years").value="25",l("#rate").value="12",l("#timing").value="end",l("#sip").value="10000",l("#lumpsum").value="0",l("#startAt").value="0",l("#stepup").value="0",l("#infl").value="0");const o=$();h(o),k(),window.scrollTo({top:0,behavior:"smooth"})}));function k(){const e=new URLSearchParams,t=(t,n)=>{""!==n&&null!=n&&!Number.isNaN(n)&&e.set(t,n)};t("mode",l("#mode").value),t("m",l("#freq").value),t("Y",l("#years").value),t("r",l("#rate").value),t("t",l("#timing").value),t("infl",l("#infl").value),t("step",l("#stepup").value),t("lump",l("#lumpsum").value),t("target",l("#target").value),t("guess",l("#guess").value),t("sip",l("#sip").value),t("startAt",l("#startAt").value),history.replaceState(null,"","?"+e.toString())}function b(){const e=new URLSearchParams(location.search),t=(t,n="")=>e.has(t)?e.get(t):n;l("#mode").value=t("mode","goal"),l("#freq").value=t("m","12"),l("#years").value=t("Y",""),l("#rate").value=t("r",""),l("#timing").value=t("t","end"),l("#infl").value=t("infl",""),l("#stepup").value=t("step",""),l("#lumpsum").value=t("lump",""),l("#target").value=t("target",""),l("#guess").value=t("guess",""),l("#sip").value=t("sip",""),l("#startAt").value=t("startAt",""),v()}const E=document.getElementById("copyLink");E&&E.addEventListener("click",(async()=>{k();try{await navigator.clipboard.writeText(location.href);const e=E.textContent;E.textContent="Copied!",setTimeout((()=>E.textContent=e),1200)}catch{}})),(()=>{const e=document.getElementById("year");e&&(e.textContent=(new Date).getFullYear()),b(),i().catch((()=>{})),setInterval((()=>i().catch((()=>{}))),3e5)})(),window.addEventListener("keydown",(e=>{const t=navigator.platform.toUpperCase().includes("MAC");(t&&e.metaKey&&"k"===e.key.toLowerCase()||!t&&e.ctrlKey&&"k"===e.key.toLowerCase())&&(e.preventDefault(),document.getElementById("years")?.focus())}))})();
