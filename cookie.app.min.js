!function(){"use strict";
/* ===== config: tickers via Sheets ===== */
var SHEET_ID="1WN8151jGQjqbfO0Aj2tK-79yJ9gCD_z0DLCdxs_higg",HL_SHEET="Headlines",HL_RANGE="A:C",
HL_URL="https://docs.google.com/spreadsheets/d/"+SHEET_ID+"/gviz/tq?tqx=out:csv&sheet="+encodeURIComponent(HL_SHEET)+"&range="+encodeURIComponent(HL_RANGE);
/* prefetch best-effort */
try{var _l=document.createElement("link");_l.rel="prefetch",_l.href=HL_URL,_l.as="fetch",_l.crossOrigin="anonymous",document.head.appendChild(_l);}catch(_){}
/* tiny CSV */
function csvParse(t){var r=[],n=[],e="",i=!1,o,a=0;for(a=0;a<t.length;a++){o=t[a];if(i){if('"'!==o)e+=o;else if('"'===t[a+1])e+='"',a++;else i=!1}else if('"'===o)i=!0;else if(","===o)n.push(e),e="";else if("\n"===o)n.push(e),r.push(n),n=[],e="";else"\r"!==o&&(e+=o)}(e.length||n.length)&&(n.push(e),r.push(n));return r}
/* cache (localStorage, 15m) */
var HL_CACHE_KEY="bs_headlines_v2",HL_TTL_MS=9e5;
function getHLCache(){try{var raw=localStorage.getItem(HL_CACHE_KEY);if(!raw)return null;var o=JSON.parse(raw);return Date.now()-o.ts>HL_TTL_MS?null:o.data}catch(e){return null}}
function setHLCache(d){try{localStorage.setItem(HL_CACHE_KEY,JSON.stringify({ts:Date.now(),data:d}))}catch(e){}}
/* fetch with timeout (700ms) */
function fetchWithTimeout(u,opts,ms){opts=opts||{};var dur=ms&&ms>0?ms:700;return new Promise(function(res,rej){var C=window.AbortController?new AbortController():{abort:function(){}},to=setTimeout(function(){try{C.abort()}catch(_){ }rej(new Error("timeout"))},dur);(window.fetch||function(){return Promise.reject(new Error("fetch missing"))})(u,{cache:"force-cache",credentials:"omit",signal:C.signal}).then(function(r){clearTimeout(to),res(r)}).catch(function(e){clearTimeout(to),rej(e)})})}
function fetchHeadlinesFast(){return fetchWithTimeout(HL_URL,{},700).then(function(r){if(!r.ok)throw new Error("HTTP "+r.status);return r.text()}).then(function(txt){if((txt||"").trim().indexOf("<")===0)return[];var rows=csvParse(txt);if(!rows.length)return[];var hdr=rows[0].map(function(h){return h.replace(/^\uFEFF/,"").trim().toLowerCase()}),iS=hdr.indexOf("section"),iT=hdr.indexOf("text");return iS<0||iT<0?[]:rows.slice(1).map(function(r){return{section:(r[iS]||"").toLowerCase().trim(),text:(r[iT]||"").trim()}}).filter(function(x){return!!x.text})}).catch(function(){return null})}
/* ticker helpers */
function setAutoDuration(el,items){var len=(items||[]).join(" • ").length||120,secs=Math.min(140,Math.max(60,Math.round(len/1.8)));try{el.style.setProperty("--dur",secs+"s")}catch(_){el.style&&(el.style.animationDuration=secs+"s")}}
function renderTicker(el,items,dir){if(!el||!items||!items.length)return;el.className="ticker "+(dir==="right"?"ticker-right":"ticker-left")+" "+(el.id==="botTicker"?"text-sm text-slate-700":"text-sm font-medium");el.innerHTML="";for(var loop=items.concat(items),i=0;i<loop.length;i++){var s=document.createElement("span");s.textContent=loop[i],el.appendChild(s)}setAutoDuration(el,items)}
function paintFromData(data){if(!data)return;for(var top=[],bot=[],i=0;i<data.length;i++)"top"===data[i].section?top.push(data[i].text):"bottom"===data[i].section&&bot.push(data[i].text);var t=document.getElementById("topTicker"),b=document.getElementById("botTicker");top.length&&renderTicker(t,top,"right");bot.length&&renderTicker(b,bot,"left")}
/* ===== cookie categories & list (static seed; extend as needed) ===== */
var CATS=[{Category:"Essential",Description:"Required to run core site features such as session management and security.",Basis:"Legitimate interests",Retention:"Session to 12 months"},{Category:"Analytics",Description:"Helps us understand usage and improve the product.",Basis:"Consent",Retention:"3–24 months"},{Category:"Marketing",Description:"Improves the relevance of messages on and off our site.",Basis:"Consent",Retention:"3–24 months"}];
var COOKIES=[{Name:"bs_session",Category:"Essential",Purpose:"Maintain logged-in session and CSRF protection",Provider:"bataSutra",Domain:"batasutra.in",Type:"First-party",Duration:"Session",Link:""},{Name:"bs_consent",Category:"Essential",Purpose:"Stores your cookie consent choices",Provider:"bataSutra",Domain:"batasutra.in",Type:"First-party",Duration:"12 months",Link:""},{Name:"_ga",Category:"Analytics",Purpose:"Google Analytics — anonymous usage statistics",Provider:"Google",Domain:".batasutra.in",Type:"Third-party",Duration:"24 months",Link:"https://policies.google.com/technologies/cookies"},{Name:"_ga_*",Category:"Analytics",Purpose:"GA4 session state",Provider:"Google",Domain:".batasutra.in",Type:"Third-party",Duration:"24 months",Link:"https://policies.google.com/technologies/cookies"},{Name:"_gid",Category:"Analytics",Purpose:"GA — distinguish users",Provider:"Google",Domain:".batasutra.in",Type:"Third-party",Duration:"24 hours",Link:"https://policies.google.com/technologies/cookies"},{Name:"_gcl_au",Category:"Marketing",Purpose:"Ad conversion tracking & attribution (Google Ads)",Provider:"Google",Domain:".batasutra.in",Type:"Third-party",Duration:"3 months",Link:"https://policies.google.com/technologies/cookies"}];
/* ===== UI renderers ===== */
function renderCats(rows){var grid=document.getElementById("catGrid");grid.innerHTML="";var fCat=document.getElementById("fCat");fCat.innerHTML='<option value="">All categories</option>';for(var i=0;i<rows.length;i++){var r=rows[i],d=document.createElement("div");d.className="p-4 rounded-lg bg-slate-50 border border-slate-200",d.innerHTML="<div class='font-semibold'>"+r.Category+"</div><div class='text-sm text-slate-700 mt-1'>"+r.Description+"</div><div class='text-xs text-slate-500 mt-2'>Basis: "+r.Basis+" • Retention: "+r.Retention+"</div>",grid.appendChild(d);var opt=document.createElement("option");opt.value=r.Category,opt.textContent=r.Category,fCat.appendChild(opt)}}
function renderCookies(rows){var body=document.getElementById("cookieBody"),q=(document.getElementById("q").value||"").toLowerCase(),cat=document.getElementById("fCat").value||"",type=document.getElementById("fType").value||"",items=[];for(var i=0;i<rows.length;i++){var r=rows[i],name=(r.Name||"").toLowerCase(),domain=(r.Domain||"").toLowerCase(),prov=(r.Provider||"").toLowerCase(),purpose=(r.Purpose||"").toLowerCase(),qok=!q||name.indexOf(q)>-1||domain.indexOf(q)>-1||prov.indexOf(q)>-1||purpose.indexOf(q)>-1,cok=!cat||r.Category===cat,tok=!type||r.Type===type;(qok&&cok&&tok)&&items.push(r)}body.innerHTML="";for(var j=0;j<items.length;j++){var rr=items[j],tr=document.createElement("tr");tr.innerHTML="<td class='px-3 py-2 font-medium'>"+rr.Name+"</td><td class='px-3 py-2'><span class='badge'>"+rr.Category+"</span></td><td class='px-3 py-2'>"+rr.Purpose+"</td><td class='px-3 py-2'>"+rr.Provider+"</td><td class='px-3 py-2'>"+rr.Domain+"</td><td class='px-3 py-2'>"+rr.Type+"</td><td class='px-3 py-2'>"+rr.Duration+"</td><td class='px-3 py-2'>"+(rr.Link?"<a class='link-ink' href='"+rr.Link+"' target='_blank' rel='noopener'>Policy</a>":"")+"</td>",body.appendChild(tr)}}
function exportCsv(rows){if(!rows||!rows.length)return;var headers=Object.keys(rows[0]),csv=[headers.join(",")];for(var i=0;i<rows.length;i++){var r=rows[i],line=[];for(var h=0;h<headers.length;h++){var k=headers[h],v=String(r[k]==null?"":r[k]).replace(/"/g,'""');line.push('"'+v+'"')}csv.push(line.join(","))}var blob=new Blob([csv.join("\n")],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(blob),a.download="bataSutra_Cookies_"+(new Date).toISOString().slice(0,10)+".csv",a.click()}
/* ===== consent storage ===== */
function getPrefs(){try{return JSON.parse(localStorage.getItem("bs_prefs")||"{}")}catch(e){return{}}}
function setPrefs(p){localStorage.setItem("bs_prefs",JSON.stringify(p));try{var ev=document.createEvent("CustomEvent");ev.initCustomEvent("bs:prefs",!1,!1,p),document.dispatchEvent(ev)}catch(_){ }}
function getConsent(){return localStorage.getItem("bs_consent")||""}
function setConsent(v){localStorage.setItem("bs_consent",v)}
function openPrefs(){var p=getPrefs();var a=document.getElementById("ckAnalytics"),m=document.getElementById("ckMarketing");a&&(a.checked=!!p.analytics);m&&(m.checked=!!p.marketing);var dlg=document.getElementById("cookieDlg");dlg&&dlg.showModal&&dlg.showModal()}
function acceptAll(){setPrefs({analytics:!0,marketing:!0,ts:Date.now()});setConsent("all");hideBanner();var d=document.getElementById("cookieDlg");d&&d.close&&d.close()}
function savePrefs(){var a=document.getElementById("ckAnalytics"),m=document.getElementById("ckMarketing");setPrefs({analytics:!!(a&&a.checked),marketing:!!(m&&m.checked),ts:Date.now()});setConsent("custom");hideBanner();var d=document.getElementById("cookieDlg");d&&d.close&&d.close()}
function rejectAll(){setPrefs({analytics:!1,marketing:!1,ts:Date.now()});setConsent("reject");hideBanner()}
function maybeShowBanner(){if(!getConsent()){var b=document.getElementById("consentBanner");b&&b.classList&&b.classList.remove("hidden")}}
function hideBanner(){var b=document.getElementById("consentBanner");b&&b.classList&&b.classList.add("hidden")}
/* ===== boot ===== */
function boot(){
  var yr=document.getElementById("year");yr&&(yr.textContent=(new Date).getFullYear().toString());
  /* reduced motion */
  try{if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches){var els=document.querySelectorAll(".ticker-left,.ticker-right");for(var i=0;i<els.length;i++)els[i].style.animation="none"}}catch(_){}
  /* wire consent buttons */
  var btn; (btn=document.getElementById("bnrManage"))&&(btn.onclick=openPrefs);
  (btn=document.getElementById("bnrAccept"))&&(btn.onclick=acceptAll);
  (btn=document.getElementById("bnrReject"))&&(btn.onclick=rejectAll);
  (btn=document.getElementById("btnAcceptAll"))&&(btn.onclick=acceptAll);
  (btn=document.getElementById("btnSavePrefs"))&&(btn.onclick=savePrefs);
  (btn=document.getElementById("dlgClose"))&&(btn.onclick=function(){var d=document.getElementById("cookieDlg");d&&d.close&&d.close()});
  (btn=document.getElementById("btnFooterManage"))&&(btn.onclick=openPrefs);
  /* filters & export */
  var q=document.getElementById("q"),fCat=document.getElementById("fCat"),fType=document.getElementById("fType");
  q&&q.addEventListener("input",function(){renderCookies(COOKIES)}); fCat&&fCat.addEventListener("change",function(){renderCookies(COOKIES)}); fType&&fType.addEventListener("change",function(){renderCookies(COOKIES)});
  var ex=document.getElementById("btnExport"); ex&&(ex.onclick=function(){exportCsv(COOKIES)});
  /* static renders */
  renderCats(CATS); renderCookies(COOKIES); maybeShowBanner();
  /* tickers: cache → fast fetch */
  var cached=getHLCache(); cached&&paintFromData(cached);
  fetchHeadlinesFast().then(function(f){if(f){setHLCache(f);paintFromData(f)}})
}
document.addEventListener("DOMContentLoaded",boot);
}();
