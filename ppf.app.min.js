(()=>{"use strict";const e="1WN8151jGQjqbfO0Aj2tK-79yJ9gCD_z0DLCdxs_higg",t="Headlines",n=(e,t,n)=>`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv&headers=1&sheet=${encodeURIComponent(t)}&range=${encodeURIComponent(n)}&t=${Date.now()}`;function o(e){if((e||"").trim().startsWith("<"))return{rows:[],isHtml:!0};const t=[];let n=[],o="",r=!1;for(let i=0;i<e.length;i++){const s=e[i];if(r)'"'!==s?o+=s:'"'===e[i+1]?(o+='"',i++):r=!1;else if('"'!==s)if(","===s)n.push(o),o="";else if("\n"===s)n.push(o),t.push(n),n=[],o="";else"\r"!==s&&(o+=s);else r=!0}return(o.length>0||n.length>0)&&(n.push(o),t.push(n)),{rows:t,isHtml:!1}}async function r({sheetId:e,sheet:t,range:r}){try{const i=await fetch(n(e,t,r),{cache:"no-store"});if(!i.ok)throw new Error("HTTP "+i.status);const s=await i.text(),{rows:a,isHtml:l}=o(s);if(l||!a.length)return[];const c=a[0].map((e=>e.replace(/^\uFEFF/,"").replace(/\u00A0/g," ").trim()));return a.slice(1).filter((e=>e.some((e=>(e??"").toString().trim()!=="")))).map((e=>Object.fromEntries(c.map(((t,n)=>[t,(e[n]??"").toString().trim()])))))}catch{return[]}}function i(e,t,n="right"){const o=document.getElementById(e);if(!o)return;o.classList.remove("ticker-left","ticker-right"),o.textContent="";[...t,...t].forEach((e=>{const t=document.createElement("span");t.textContent=String(e||"").trim(),o.appendChild(t)}));void o.offsetWidth,o.classList.add("right"===n?"ticker-right":"ticker-left","ticker");const r=o.parentElement?.clientWidth||0;for(;o.scrollWidth<2*r;){const e=o.cloneNode(!0);[...e.children].forEach((e=>o.appendChild(e)))}}async function s(){const t=await r({sheetId:e,sheet:"Headlines",range:"A:B"}),n=t.filter((e=>/^top$/i.test(e.Section||""))).map((e=>e.Text)).filter(Boolean),o=t.filter((e=>/^bottom$/i.test(e.Section||""))).map((e=>e.Text)).filter(Boolean);n.length&&i("topTicker",n,"right"),o.length&&i("bottomTicker",o,"left")}const a=e=>document.querySelector(e),l=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("en-IN",{maximumFractionDigits:t}):"—",c=e=>{const t=Number(e);return Number.isFinite(t)?t:0},d=(e,t)=>{const n=document.getElementById(e);if(!n)return;const o=String(null!=t?t:"—");n.textContent=o,n.title=o};function u({startYear:e,years:t,annual:n,stepUpPct:o,ratePct:r,extMode:i}){const s=r/100,a=o/100,l=[];let c=0,d=0,u=0,p=n;for(let n=0;n<t;n++){const t=n<15,f=t?p:"cont"===i?p:0,m=(c+f)*s,h=c+f+m;l.push({closing:h}),d+=f,u+=m,c=h,p*=1+a}return{rows:l,totalInv:d,totalInt:u,corpus:c}}function p(e){d("totInv","₹ "+l(e.totalInv)),d("totInt","₹ "+l(e.totalInt)),d("corpus","₹ "+l(e.corpus));const t=e.totalInv>0?(e.corpus/e.totalInv).toFixed(2)+"×":"—";d("multiple",t);const n=e.rows[14];d("y15",n?"₹ "+l(n.closing):"—")}function f(){const e=new URLSearchParams,t=(t,n)=>{""!==n&&null!=n&&e.set(t,n)};t("sy",a("#startYear").value),t("y",a("#years").value),t("a",a("#annual").value),t("su",a("#stepUp").value),t("r",a("#rate").value),t("em",a("#extMode").value),history.replaceState(null,"","?"+e.toString())}function m(){const e=new URLSearchParams(location.search),t=(t,n="")=>e.has(t)?e.get(t):n;a("#startYear").value=t("sy","2025"),a("#years").value=t("y","15"),a("#annual").value=t("a","150000"),a("#stepUp").value=t("su","0"),a("#rate").value=t("r","7.1"),a("#extMode").value=t("em","cont")}function h(){const e={startYear:Number(a("#startYear").value||0),years:Number(a("#years").value||15),annual:Math.max(0,c(a("#annual").value)),stepUpPct:Math.max(0,c(a("#stepUp").value)),ratePct:Math.max(0,c(a("#rate").value)),extMode:a("#extMode").value},t=a("#msg");if(t.textContent="",!(e.startYear>=1970))return void(t.textContent="Enter a valid start year.");if(!(e.years>=15))return void(t.textContent="Horizon must be at least 15 years.");const n=u(e);p(n),f()}a("#run").addEventListener("click",h),a("#reset").addEventListener("click",(()=>{["#annual","#stepUp","#rate"].forEach((e=>a(e).value="")),a("#startYear").value="2025",a("#years").value="15",a("#extMode").value="cont",["totInv","totInt","corpus","multiple","y15"].forEach((e=>d(e,"—"))),a("#msg").textContent="",f()}));function g(e){"ex1"===e&&(a("#startYear").value=2025,a("#years").value=15,a("#annual").value=150000,a("#stepUp").value=0,a("#rate").value=7.1,a("#extMode").value="cont"),"ex2"===e&&(a("#startYear").value=2025,a("#years").value=20,a("#annual").value=150000,a("#stepUp").value=5,a("#rate").value=7.1,a("#extMode").value="cont"),"ex3"===e&&(a("#startYear").value=2025,a("#years").value=25,a("#annual").value=120000,a("#stepUp").value=0,a("#rate").value=7.1,a("#extMode").value="noCont"),h(),window.scrollTo({top:0,behavior:"smooth"})}document.addEventListener("click",(e=>{const t=e.target.closest("[data-ex]");t&&g(t.getAttribute("data-ex"))}));const y=document.getElementById("copyLink");y&&y.addEventListener("click",(async()=>{f();try{await navigator.clipboard.writeText(location.href);const e=y.textContent;y.textContent="Copied!",setTimeout((()=>y.textContent=e),1200)}catch{}})),(()=>{const e=document.getElementById("year");e&&(e.textContent=(new Date).getFullYear()),m(),s().catch((()=>{})),h()})(),window.addEventListener("keydown",(e=>{const t=navigator.platform.toUpperCase().includes("MAC");(t&&e.metaKey&&"k"===e.key.toLowerCase()||!t&&e.ctrlKey&&"k"===e.key.toLowerCase())&&(e.preventDefault(),document.getElementById("startYear")?.focus())}))})();
