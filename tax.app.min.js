(()=>{"use strict";const e="1WN8151jGQjqbfO0Aj2tK-79yJ9gCD_z0DLCdxs_higg",t=(e,t,n)=>`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv&headers=1&sheet=${encodeURIComponent(t)}&range=${encodeURIComponent(n)}&t=${Date.now()}`;function n(e){if((e||"").trim().startsWith("<"))return{rows:[],isHtml:!0};const t=[];let n=[],o="",r=!1;for(let i=0;i<e.length;i++){const s=e[i];if(r)'"'!==s?o+=s:'"'===e[i+1]?(o+='"',i++):r=!1;else if('"'!==s)if(","===s)n.push(o),o="";else if("\n"===s)n.push(o),t.push(n),n=[],o="";else"\r"!==s&&(o+=s);else r=!0}return(o.length>0||n.length>0)&&(n.push(o),t.push(n)),{rows:t,isHtml:!1}}async function o({sheetId:e,sheet:o,range:r}){try{const i=await fetch(t(e,o,r),{cache:"no-store"});if(!i.ok)throw new Error("HTTP "+i.status);const s=await i.text(),{rows:a,isHtml:l}=n(s);if(l||!a.length)return[];const c=a[0].map((e=>e.replace(/^\uFEFF/,"").replace(/\u00A0/g," ").trim()));return a.slice(1).filter((e=>e.some((e=>(e??"").toString().trim()!=="")))).map((e=>Object.fromEntries(c.map(((t,n)=>[t,(e[n]??"").toString().trim()])))))}catch{return[]}}function r(e,t,n="right"){const o=document.getElementById(e);if(!o)return;o.classList.remove("ticker-left","ticker-right"),o.textContent="";[...t,...t].forEach((e=>{const t=document.createElement("span");t.textContent=String(e||"").trim(),o.appendChild(t)}));void o.offsetWidth,o.classList.add("right"===n?"ticker-right":"ticker-left","ticker");const r=o.parentElement?.clientWidth||0;for(;o.scrollWidth<2*r;){const e=o.cloneNode(!0);[...e.children].forEach((e=>o.appendChild(e)))}}async function i(){const t=await o({sheetId:e,sheet:"Headlines",range:"A:B"}),n=t.filter((e=>/^top$/i.test(e.Section||""))).map((e=>e.Text)).filter(Boolean),i=t.filter((e=>/^bottom$/i.test(e.Section||""))).map((e=>e.Text)).filter(Boolean);n.length&&r("topTicker",n,"right"),i.length&&r("bottomTicker",i,"left")}const s=e=>document.querySelector(e),a=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("en-IN",{maximumFractionDigits:t}):"—",l=e=>{const t=Number(e);return Number.isFinite(t)?t:0},c=(e,t)=>{const n=document.getElementById(e);if(!n)return;const o=String(null!=t?t:"—");n.textContent=o,n.title=o},d=[0,250000,500000,1e6],u=[0,5,20,30],m=[0,3e5,6e5,9e5,1200000,1500000],f=[0,5,10,15,20,30],p=.04,h=5e5,g=7e5;function y(e,t,n,o){let r=0;if(e<=0)return 0;for(let i=0;i<t.length;i++){const s=t[i],a=i+1<t.length?t[i+1]:e,l=Math.min(a,e),c=Math.max(0,l-s),d((n[i]??n[n.length-1]??0)/100);if(c>0)r+=c*d}function d(e){return e}return r}function v(e,t,n,o){const r=Math.max(0,"old"===e?t-n-o-t: t-n-o-t);return r,0}function S(e,t,n,o){const r=Math.max(0,"old"===e?t-n-o: t-n-o),i="old"===e?d:m,s="old"===e?u:f,a="old"===e?h:g,l=y(r,i,s),c=r>0&&r<=a?0:l;return{taxable:r,baseTax:l,tax:c*(1+p)}}function E(){const e=l(s("#income").value),t=l(s("#std").value||5e4),n=l(s("#oldDed").value),o=l(s("#ccd2").value),r=S("old",e,t,n,o),i=S("new",e,t,0,o),d=e>0?(r.tax/e*100).toFixed(2)+"%":"—",u=e>0?(i.tax/e*100).toFixed(2)+"%":"—",m=`₹ ${a(e-r.tax)}`,f=`₹ ${a(e-i.tax)}`;c("oldTax",`₹ ${a(r.tax)}`),c("newTax",`₹ ${a(i.tax)}`),c("oldEff",d),c("newEff",u),c("oldTake",m),c("newTake",f);const h=i.tax<r.tax?"New":i.tax>r.tax?"Old":"Either",g=Math.abs(i.tax-r.tax);document.getElementById("rec").innerHTML="Either"===h?"Both regimes are roughly equal for your inputs. Choose the one that’s simpler for your documentation.":`<b>${h} regime</b> yields ~<b>₹${a(g)}</b> lower tax.`,s("#msg").textContent="Done.",b()}function b(){const e=new URLSearchParams,t=(t,n)=>{""!==n&&null!=n&&e.set(t,n)};t("i",s("#income").value),t("s",s("#std").value),t("o",s("#oldDed").value),t("n",s("#ccd2").value),history.replaceState(null,"","?"+e.toString())}function L(){const e=new URLSearchParams(location.search),t=t=>e.has(t)?e.get(t):"";s("#income").value=t("i"),s("#std").value=t("s")||"50000",s("#oldDed").value=t("o"),s("#ccd2").value=t("n")}document.getElementById("calc").addEventListener("click",E),document.getElementById("reset").addEventListener("click",(()=>{["#income","#oldDed","#ccd2"].forEach((e=>s(e).value="")),s("#std").value="50000",["oldTax","newTax","oldEff","newEff","oldTake","newTake"].forEach((e=>c(e,"—"))),document.getElementById("rec").textContent="—",s("#msg").textContent="",b()})),document.addEventListener("click",(e=>{const t=e.target.closest("[data-ex]");t&&(()=>{const e=t.getAttribute("data-ex");"ex1"===e&&(s("#income").value=750000,s("#std").value=5e4,s("#oldDed").value=175000,s("#ccd2").value=0),"ex2"===e&&(s("#income").value=1200000,s("#std").value=5e4,s("#oldDed").value=2e5,s("#ccd2").value=5e5),"ex3"===e&&(s("#income").value=2400000,s("#std").value=5e4,s("#oldDed").value=3e5,s("#ccd2").value=1e6),E()})()}));(()=>{const e=document.getElementById("year");e&&(e.textContent=(new Date).getFullYear()),L(),i().catch((()=>{}))})(),window.addEventListener("keydown",(e=>{const t=navigator.platform.toUpperCase().includes("MAC");(t&&e.metaKey&&"k"===e.key.toLowerCase()||!t&&e.ctrlKey&&"k"===e.key.toLowerCase())&&(e.preventDefault(),document.getElementById("income")?.focus())}))})();
