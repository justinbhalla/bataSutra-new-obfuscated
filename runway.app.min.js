(()=>{"use strict";const e="1WN8151jGQjqbfO0Aj2tK-79yJ9gCD_z0DLCdxs_higg",t="Headlines",n=(e,t,n)=>`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv&headers=1&sheet=${encodeURIComponent(t)}&range=${encodeURIComponent(n)}&t=${Date.now()}`,o=(e,t)=>`https://docs.google.com/spreadsheets/d/${e}/export?format=csv&id=${e}&gid=${encodeURIComponent(t)}&t=${Date.now()}`;function r(e){if((e||"").trim().startsWith("<"))return{rows:[],isHtml:!0};const t=[];let n=[],o="",r=!1;for(let i=0;i<e.length;i++){const s=e[i];if(r)'"'!==s?o+=s:'"'===e[i+1]?(o+='"',i++):r=!1;else if('"'!==s)if(","===s)n.push(o),o="";else if("\n"===s)n.push(o),t.push(n),n=[],o="";else"\r"!==s&&(o+=s);else r=!0}return(o.length>0||n.length>0)&&(n.push(o),t.push(n)),{rows:t,isHtml:!1}}async function i({sheetId:e,sheet:t,range:i,gid:s,label:a}){const l=[{url:n(e,t,i),kind:"gviz"}];s&&String(s).trim()&&l.push({url:o(e,s),kind:"export"});let c=null;for(const e of l)try{const t=await fetch(e.url,{cache:"no-store"});if(!t.ok)throw new Error("HTTP "+t.status);const n=await t.text(),{rows:o,isHtml:i}=r(n);if(i)throw new Error("Returned HTML (tab likely not public)");if(!o.length)throw new Error("Empty CSV");const s=o[0].map((e=>e.replace(/^\uFEFF/,"").replace(/\u00A0/g," ").trim()));return{data:o.slice(1).filter((e=>e.some((e=>(e??"").toString().trim()!=="")))).map((e=>Object.fromEntries(s.map(((t,n)=>[t,(e[n]??"").toString().trim()]))))),route:e.kind}}catch(e){c=e}throw new Error(`${a} fetch failed: ${c?.message||"Unknown"}`)}function s(e,t,n="right"){const o=document.getElementById(e);if(!o)return;o.classList.remove("ticker-left","ticker-right"),o.textContent="";[...t,...t].forEach((e=>{const t=document.createElement("span");t.textContent=String(e||"").trim(),o.appendChild(t)}));void o.offsetWidth,o.classList.add("right"===n?"ticker-right":"ticker-left","ticker");const r=o.parentElement?.clientWidth||0;for(;o.scrollWidth<2*r;){const e=o.cloneNode(!0);[...e.children].forEach((e=>o.appendChild(e)))}}async function a(){try{const{data:n}=await i({sheetId:e,sheet:t,range:"A:B",gid:"",label:"Headlines"}),o=n.filter((e=>/^top$/i.test((e.Section||"").toString()))).map((e=>e.Text)).filter(Boolean),r=n.filter((e=>/^bottom$/i.test((e.Section||"").toString()))).map((e=>e.Text)).filter(Boolean);o.length&&s("topTicker",o,"right"),r.length&&s("bottomTicker",r,"left")}catch{}}const l=e=>document.querySelector(e),c=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("en-IN",{maximumFractionDigits:t}):"—",d=e=>{const t=Number(e);return Number.isFinite(t)?t:0},u=(e,t)=>{const n=document.getElementById(e);if(!n)return;const o=String(null!=t?t:"—");n.textContent=o,n.title=o};function m(){const e=d(l("#income").value),t=d(l("#expenses").value),n=d(l("#assets").value),o=Math.max(1,Math.floor(d(l("#horizon").value)||12)),r=Math.max(0,d(l("#drop").value))/100,i=Math.max(0,d(l("#surge").value))/100,s=Math.max(0,d(l("#shock").value)),a=e*(1-r),m=t*(1+i),f=m-a,h=Math.max(n-s,0);u("burn",f<=0?`Saving ₹${c(Math.abs(f))}/mo`:`₹${c(f)}/mo`),u("usable",`₹${c(h)}`);let g="—",p="—";if(f<=0)g="∞ (no depletion)",p=`₹${c(h+Math.abs(f)*o)}`;else{const e=h/f,t=Math.max(0,Math.floor(10*e)/10);g=`${t} month${1===t?"":"s"}`;const n=h-f*o;p=n<=0?"₹0":`₹${c(n)}`}u("runway",g),u("leftover",p),l("#msg").textContent="Done.",y()}document.getElementById("calc").addEventListener("click",m),document.getElementById("reset").addEventListener("click",(()=>{["#income","#expenses","#assets","#horizon","#drop","#surge","#shock"].forEach((e=>l(e).value="")),["burn","runway","usable","leftover"].forEach((e=>u(e,"—"))),l("#msg").textContent="",y()})),document.addEventListener("click",(e=>{const t=e.target.closest("[data-ex]");if(!t)return;(({key:e})=>{"ex1"===e&&(l("#income").value=150000,l("#expenses").value=85000,l("#assets").value=1200000,l("#drop").value=0,l("#surge").value=0,l("#shock").value=0,l("#horizon").value=12),"ex2"===e&&(l("#income").value=150000,l("#expenses").value=85000,l("#assets").value=700000,l("#drop").value=100,l("#surge").value=0,l("#shock").value=0,l("#horizon").value=12),"ex3"===e&&(l("#income").value=150000,l("#expenses").value=85000,l("#assets").value=500000,l("#drop").value=30,l("#surge").value=10,l("#shock").value=0,l("#horizon").value=12),m()})({key:t.getAttribute("data-ex")})}));function y(){const e=new URLSearchParams,t=(t,n)=>{""!==n&&null!=n&&e.set(t,n)};t("i",l("#income").value),t("e",l("#expenses").value),t("a",l("#assets").value),t("h",l("#horizon").value),t("d",l("#drop").value),t("s",l("#surge").value),t("k",l("#shock").value),history.replaceState(null,"","?"+e.toString())}function f(){const e=new URLSearchParams(location.search),t=t=>e.has(t)?e.get(t):"";l("#income").value=t("i"),l("#expenses").value=t("e"),l("#assets").value=t("a"),l("#horizon").value=t("h"),l("#drop").value=t("d"),l("#surge").value=t("s"),l("#shock").value=t("k")}(()=>{const e=document.getElementById("year");e&&(e.textContent=(new Date).getFullYear());const t=document.getElementById("copyLink");t&&t.addEventListener("click",(async()=>{try{await navigator.clipboard.writeText(location.href);const e=t.textContent;t.textContent="Copied!",setTimeout((()=>t.textContent=e),1200)}catch{}})),f(),a().catch((()=>{}))})(),window.addEventListener("keydown",(e=>{const t=navigator.platform.toUpperCase().includes("MAC");(t&&e.metaKey&&"k"===e.key.toLowerCase()||!t&&e.ctrlKey&&"k"===e.key.toLowerCase())&&(e.preventDefault(),document.getElementById("income")?.focus())}))})();
