(()=>{"use strict";const S="1WN8151jGQjqbfO0Aj2tK-79yJ9gCD_z0DLCdxs_higg",T=["Sensex ▲","NIFTY50 ▲","Brent Crude ▼","USD/INR ↔","Gold (MCX) ▲","India VIX ▼"],B=["Mutual fund SIP inflows hit record","RBI policy unchanged","GST collection beats estimates"],g=(e,t,r)=>`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv&headers=1&sheet=${encodeURIComponent(t)}&range=${encodeURIComponent(r)}&t=${Date.now()}`,p=e=>{if((e||"").trim().startsWith("<"))return{rows:[],isHtml:!0};const t=[];let r=[],n="",o=!1;for(let c=0;c<e.length;c++){const i=e[c];if(o)'"'===i?'"'===e[c+1]?(n+='"',c++):o=!1:n+=i;else if('"'===i)o=!0;else if(","===i)r.push(n),n="";else if("\n"===i)r.push(n),t.push(r),r=[],n="";else"\r"!==i&&(n+=i)}return(n.length>0||r.length>0)&&(r.push(n),t.push(r)),{rows:t,isHtml:!1}},f=async(e,t)=>{const r=await fetch(g(S,e,t),{cache:"no-store"});if(!r.ok)throw new Error("Sheet fetch failed: "+e);const n=await r.text(),{rows:o,isHtml:c}=p(n);if(c)throw new Error("Not CSV (publish-to-web missing?)");if(!o.length)return[];const i=o[0].map((l=>l.replace(/^\uFEFF/,"").replace(/\u00A0/g," ").trim()));return o.slice(1).filter((l=>l.some((a=>((a??"")+"").trim()!=="")))).map((l=>Object.fromEntries(i.map(((a,d)=>[a,(l[d]??"")+"".trim()])))))},w=e=>{const t=e?.parentElement?.clientWidth||0;if(!t||!e)return;for(;e.scrollWidth<t*2;)[...e.children].forEach((r=>e.appendChild(r.cloneNode(!0))))},R=(e,t,r="right")=>{const n=document.getElementById(e);if(!n)return;n.classList.remove("ticker-left","ticker-right"),n.innerHTML="";const o=t&&t.length?t:"topTicker"===e?T:B;[...o,...o].forEach((c=>{const i=document.createElement("span");i.textContent=String(c||"").trim(),n.appendChild(i)})),w(n),void n.offsetWidth,n.classList.add("right"===r?"ticker-right":"ticker-left","ticker")},H=async()=>{try{const e=await f("Headlines","A:B"),t=e.filter((r=>/^top$/i.test(r.Section||""))).map((r=>r.Text)).filter(Boolean),r=e.filter((n=>/^bottom$/i.test(n.Section||""))).map((n=>n.Text)).filter(Boolean);t.length&&R("topTicker",t,"right"),r.length&&R("bottomTicker",r,"left")}catch(e){console.warn("Headlines error",e?.message||e),R("topTicker",T,"right"),R("bottomTicker",B,"left")}},y=()=>{const e=document.getElementById("year");e&&(e.textContent=(new Date).getFullYear())},G=()=>{let e;window.addEventListener("resize",(()=>{cancelAnimationFrame(e),e=requestAnimationFrame((()=>{w(document.getElementById("topTicker")),w(document.getElementById("bottomTicker"))}))}))},I=()=>{y(),R("topTicker",T,"right"),R("bottomTicker",B,"left"),H();const e=setInterval(H,3e5);window.addEventListener("pagehide",(()=>clearInterval(e))),G()};document.addEventListener("DOMContentLoaded",I)})();
